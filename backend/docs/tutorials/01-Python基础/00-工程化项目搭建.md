# å·¥ç¨‹åŒ–é¡¹ç›®æ­å»º

## ğŸ¯ å­¦ä¹ ç›®æ ‡
- ç†è§£ä¸ºä»€ä¹ˆéœ€è¦å·¥ç¨‹åŒ–é¡¹ç›®ç®¡ç†
- æŒæ¡è™šæ‹Ÿç¯å¢ƒä¸ä¾èµ–éš”ç¦»
- å­¦ä¼šé…ç½®æ–‡ä»¶ç®¡ç†ä¸ç¯å¢ƒå˜é‡
- é…ç½®ä¸“ä¸šçš„æ—¥å¿—ç³»ç»Ÿ
- å»ºç«‹ä»£ç è§„èŒƒå·¥å…·é“¾

## ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å·¥ç¨‹åŒ–

### å®é™…é—®é¢˜åœºæ™¯

**åœºæ™¯1ï¼šä¾èµ–å†²çª**
```bash
# é¡¹ç›®Aéœ€è¦ requests==2.28.0
# é¡¹ç›®Béœ€è¦ requests==2.31.0
# å¦‚æœéƒ½å®‰è£…åˆ°ç³»ç»ŸPythonï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
```

**åœºæ™¯2ï¼šé…ç½®æ··ä¹±**
```python
# å¼€å‘ç¯å¢ƒç”¨ localhost:3306
# ç”Ÿäº§ç¯å¢ƒç”¨ 192.168.1.100:3306
# ä»£ç é‡Œç¡¬ç¼–ç æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Ÿ
```

**åœºæ™¯3ï¼šè°ƒè¯•å›°éš¾**
```python
# ç”¨æˆ·æŠ¥å‘Š"ç³»ç»Ÿå‡ºé”™äº†"
# ä½†æ²¡æœ‰æ—¥å¿—ï¼Œæ²¡æœ‰é”™è¯¯å †æ ˆï¼Œå¦‚ä½•å®šä½é—®é¢˜ï¼Ÿ
```

**åœºæ™¯4ï¼šä»£ç é£æ ¼ä¸ç»Ÿä¸€**
```python
# å¼ ä¸‰å†™çš„ä»£ç 
def getUserInfo(id):
    return db.query("select * from user where id="+str(id))

# æå››å†™çš„ä»£ç 
def get_user_info(user_id: int) -> User:
    return db.execute(
        f"SELECT * FROM users WHERE user_id = {user_id}"
    )
```

### ä¸ç”¨å·¥ç¨‹åŒ–ä¼šæœ‰ä»€ä¹ˆé—®é¢˜

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | åæœ |
|---------|---------|------|
| ä¾èµ–å†²çª | ä¸åŒé¡¹ç›®éœ€è¦ä¸åŒç‰ˆæœ¬çš„åŒ… | ç¯å¢ƒæ±¡æŸ“ï¼Œé¡¹ç›®æ— æ³•è¿è¡Œ |
| é…ç½®æ³„éœ² | æ•æ„Ÿä¿¡æ¯å†™æ­»åœ¨ä»£ç ä¸­ | æ•°æ®åº“å¯†ç æ³„éœ²åˆ°GitHub |
| è°ƒè¯•å›°éš¾ | æ²¡æœ‰æ—¥å¿—ç³»ç»Ÿ | ç”Ÿäº§é—®é¢˜æ— æ³•å®šä½ |
| åä½œå›°éš¾ | ä»£ç é£æ ¼ä¸ç»Ÿä¸€ | ä»£ç å®¡æŸ¥æ•ˆç‡ä½ |
| éƒ¨ç½²å¤æ‚ | ç¼ºå°‘æ ‡å‡†åŒ–æµç¨‹ | ä¸Šçº¿å®¹æ˜“å‡ºé—®é¢˜ |

### è§£å†³æ–¹æ¡ˆä»·å€¼

```
å·¥ç¨‹åŒ–é¡¹ç›®ç®¡ç†
â”œâ”€â”€ è™šæ‹Ÿç¯å¢ƒ â†’ ä¾èµ–éš”ç¦»ï¼Œé¿å…å†²çª
â”œâ”€â”€ é…ç½®ç®¡ç† â†’ æ•æ„Ÿä¿¡æ¯åˆ†ç¦»ï¼Œç¯å¢ƒåˆ‡æ¢
â”œâ”€â”€ æ—¥å¿—ç³»ç»Ÿ â†’ é—®é¢˜è¿½è¸ªï¼Œæ€§èƒ½åˆ†æ
â””â”€â”€ ä»£ç è§„èŒƒ â†’ å›¢é˜Ÿåä½œï¼Œè´¨é‡ä¿è¯
```

**æ”¶ç›Š**ï¼š
- å¼€å‘æ•ˆç‡æå‡ 50%
- Bug å®šä½æ—¶é—´å‡å°‘ 70%
- æ–°äººä¸Šæ‰‹æ—¶é—´ç¼©çŸ­ 60%
- ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§æå‡ 80%

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

### æ˜¯ä»€ä¹ˆï¼ˆWhatï¼‰

**å·¥ç¨‹åŒ–é¡¹ç›®ç®¡ç†**æ˜¯æŒ‡ç”¨ç³»ç»ŸåŒ–çš„æ–¹æ³•ç®¡ç†è½¯ä»¶å¼€å‘çš„å„ä¸ªç¯èŠ‚ï¼ŒåŒ…æ‹¬ä¾èµ–ã€é…ç½®ã€æ—¥å¿—ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ã€‚

**æ ¸å¿ƒè¦ç´ **ï¼š

1. **è™šæ‹Ÿç¯å¢ƒ**ï¼šç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒ
2. **ä¾èµ–ç®¡ç†**ï¼šè‡ªåŠ¨å®‰è£…å’Œç‰ˆæœ¬æ§åˆ¶
3. **é…ç½®ç®¡ç†**ï¼šç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
4. **æ—¥å¿—ç³»ç»Ÿ**ï¼šç»“æ„åŒ–æ—¥å¿—è®°å½•
5. **ä»£ç è§„èŒƒ**ï¼šè‡ªåŠ¨æ ¼å¼åŒ–å’Œé™æ€æ£€æŸ¥

### æ€ä¹ˆç”¨ï¼ˆHowï¼‰

#### 1. è™šæ‹Ÿç¯å¢ƒä¸ä¾èµ–ç®¡ç†

**æ¨èæ–¹æ¡ˆï¼šPoetry**

```bash
# å®‰è£… Poetry
pip install poetry

# åˆ›å»ºæ–°é¡¹ç›®
poetry new accounting-system
cd accounting-system

# æ·»åŠ ä¾èµ–
poetry add fastapi uvicorn sqlalchemy pydantic-settings

# æ·»åŠ å¼€å‘ä¾èµ–
poetry add --group dev black ruff loguru pytest

# å®‰è£…æ‰€æœ‰ä¾èµ–
poetry install

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
poetry shell
```

**ç›®å½•ç»“æ„**ï¼š
```
accounting-system/
â”œâ”€â”€ pyproject.toml          # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ poetry.lock             # é”å®šç‰ˆæœ¬
â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .env                    # å®é™…ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .gitignore              # Gitå¿½ç•¥è§„åˆ™
â”œâ”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â””â”€â”€ accounting_system/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ main.py         # åº”ç”¨å…¥å£
â”‚       â”œâ”€â”€ config/         # é…ç½®æ¨¡å—
â”‚       â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘
â”‚       â”œâ”€â”€ api/            # APIè·¯ç”±
â”‚       â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/                  # æµ‹è¯•ä»£ç 
â”œâ”€â”€ logs/                   # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ docs/                   # æ–‡æ¡£
```

**pyproject.toml ç¤ºä¾‹**ï¼š
```toml
[tool.poetry]
name = "accounting-system"
version = "0.1.0"
description = "è®°è´¦ç³»ç»Ÿåç«¯"
authors = ["Your Name <you@example.com>"]

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.109.0"
uvicorn = {extras = ["standard"], version = "^0.27.0"}
sqlalchemy = "^2.0.25"
pydantic-settings = "^2.1.0"
python-multipart = "^0.0.6"
alembic = "^1.13.0"

[tool.poetry.group.dev.dependencies]
black = "^24.1.1"
ruff = "^0.1.15"
loguru = "^0.7.2"
pytest = "^7.4.4"
pytest-asyncio = "^0.23.3"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 100
target-version = ['py311']

[tool.ruff]
line-length = 100
select = ["E", "F", "W", "I", "N"]
```

#### 2. é…ç½®æ–‡ä»¶ç®¡ç†

**ä½¿ç”¨ pydantic-settings**ï¼š

```python
# src/accounting_system/config/settings.py
from pydantic import Field
from pydantic_settings import BaseSettings, SettingsConfigDict


class Settings(BaseSettings):
    """åº”ç”¨é…ç½®"""

    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        case_sensitive=False,
    )

    # åº”ç”¨é…ç½®
    APP_NAME: str = Field(default="è®°è´¦ç³»ç»Ÿ", description="åº”ç”¨åç§°")
    APP_VERSION: str = Field(default="0.1.0", description="åº”ç”¨ç‰ˆæœ¬")
    DEBUG: bool = Field(default=False, description="è°ƒè¯•æ¨¡å¼")

    # æœåŠ¡å™¨é…ç½®
    HOST: str = Field(default="127.0.0.1", description="æœåŠ¡å™¨åœ°å€")
    PORT: int = Field(default=9099, description="æœåŠ¡å™¨ç«¯å£")

    # æ•°æ®åº“é…ç½®
    DB_HOST: str = Field(default="localhost", description="æ•°æ®åº“åœ°å€")
    DB_PORT: int = Field(default=3306, description="æ•°æ®åº“ç«¯å£")
    DB_USER: str = Field(default="root", description="æ•°æ®åº“ç”¨æˆ·")
    DB_PASSWORD: str = Field(default="", description="æ•°æ®åº“å¯†ç ")
    DB_NAME: str = Field(default="accounting", description="æ•°æ®åº“åç§°")

    # Redisé…ç½®
    REDIS_HOST: str = Field(default="localhost", description="Redisåœ°å€")
    REDIS_PORT: int = Field(default=6379, description="Redisç«¯å£")
    REDIS_PASSWORD: str = Field(default="", description="Rediså¯†ç ")
    REDIS_DB: int = Field(default=0, description="Redisæ•°æ®åº“")

    # JWTé…ç½®
    SECRET_KEY: str = Field(
        default="your-secret-key-change-in-production",
        description="JWTå¯†é’¥"
    )
    ALGORITHM: str = Field(default="HS256", description="JWTç®—æ³•")
    EXPIRE_MINUTES: int = Field(default=60 * 24 * 7, description="è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰")

    @property
    def DATABASE_URL(self) -> str:
        """æ•°æ®åº“è¿æ¥URL"""
        return (
            f"mysql+pymysql://{self.DB_USER}:{self.DB_PASSWORD}"
            f"@{self.DB_HOST}:{self.DB_PORT}/{self.DB_NAME}"
        )

    @property
    def REDIS_URL(self) -> str:
        """Redisè¿æ¥URL"""
        return f"redis://{self.REDIS_HOST}:{self.REDIS_PORT}/{self.REDIS_DB}"


# å…¨å±€é…ç½®å®ä¾‹
settings = Settings()
```

**ç¯å¢ƒå˜é‡æ–‡ä»¶ .env**ï¼š
```env
# åº”ç”¨é…ç½®
APP_NAME=è®°è´¦ç³»ç»Ÿ
DEBUG=True

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=accounting

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWTé…ç½®
SECRET_KEY=your-secret-key-change-in-production
ALGORITHM=HS256
EXPIRE_MINUTES=10080
```

**ç¯å¢ƒå˜é‡æ¨¡æ¿ .env.example**ï¼š
```env
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env å¹¶å¡«å†™å®é™…å€¼

# åº”ç”¨é…ç½®
APP_NAME=è®°è´¦ç³»ç»Ÿ
DEBUG=True

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=accounting

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWTé…ç½®
SECRET_KEY=your-secret-key-change-in-production
ALGORITHM=HS256
EXPIRE_MINUTES=10080
```

#### 3. æ—¥å¿—ç³»ç»Ÿé…ç½®

**ä½¿ç”¨ loguru**ï¼š

```python
# src/accounting_system/config/logger.py
import sys
from pathlib import Path
from loguru import logger


def setup_logger():
    """é…ç½®æ—¥å¿—ç³»ç»Ÿ"""

    # ç§»é™¤é»˜è®¤å¤„ç†å™¨
    logger.remove()

    # æ§åˆ¶å°è¾“å‡ºï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    logger.add(
        sys.stdout,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | "
               "<level>{level: <8}</level> | "
               "<cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> | "
               "<level>{message}</level>",
        level="DEBUG",
        colorize=True,
    )

    # æ–‡ä»¶è¾“å‡ºï¼ˆæ‰€æœ‰æ—¥å¿—ï¼‰
    log_path = Path("logs")
    log_path.mkdir(exist_ok=True)

    logger.add(
        log_path / "app_{time:YYYY-MM-DD}.log",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} | {message}",
        level="DEBUG",
        rotation="00:00",  # æ¯å¤©åˆå¤œåˆ‡æ¢
        retention="30 days",  # ä¿ç•™30å¤©
        compression="zip",  # å‹ç¼©æ—§æ—¥å¿—
        encoding="utf-8",
    )

    # æ–‡ä»¶è¾“å‡ºï¼ˆé”™è¯¯æ—¥å¿—ï¼‰
    logger.add(
        log_path / "error_{time:YYYY-MM-DD}.log",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} | {message}",
        level="ERROR",
        rotation="00:00",
        retention="90 days",  # é”™è¯¯æ—¥å¿—ä¿ç•™90å¤©
        compression="zip",
        encoding="utf-8",
    )

    return logger


# åˆå§‹åŒ–æ—¥å¿—
setup_logger()
```

#### 4. ä»£ç è§„èŒƒå·¥å…·

**blackï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰**ï¼š
```bash
# æ ¼å¼åŒ–ä»£ç 
black src/

# æ£€æŸ¥ä½†ä¸ä¿®æ”¹
black --check src/

# é…ç½®æ–‡ä»¶å·²åœ¨ pyproject.toml ä¸­å®šä¹‰
```

**ruffï¼ˆå¿«é€Ÿæ£€æŸ¥ï¼‰**ï¼š
```bash
# æ£€æŸ¥ä»£ç 
ruff check src/

# è‡ªåŠ¨ä¿®å¤
ruff check --fix src/
```

**pre-commit é’©å­**ï¼š
```bash
# å®‰è£… pre-commit
pip install pre-commit

# åˆ›å»º .pre-commit-config.yaml
cat > .pre-commit-config.yaml << 'EOF'
repos:
  - repo: https://github.com/psf/black
    rev: 24.1.1
    hooks:
      - id: black

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.15
    hooks:
      - id: ruff
        args: [--fix]
EOF

# å®‰è£…é’©å­
pre-commit install
```

#### 5. .gitignore é…ç½®

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# è™šæ‹Ÿç¯å¢ƒ
venv/
env/
ENV/
.venv

# Poetry
poetry.lock

# ç¯å¢ƒå˜é‡
.env
.env.local
.env.*.local

# IDE
.idea/
.vscode/
*.swp
*.swo
*~

# æ—¥å¿—
logs/
*.log

# æ•°æ®åº“
*.db
*.sqlite
*.sqlite3

# æµ‹è¯•
.pytest_cache/
.coverage
htmlcov/

# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db
```

### ä¸ºä»€ä¹ˆï¼ˆWhyï¼‰

#### ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç¯å¢ƒï¼Ÿ

**åŸç†**ï¼š
```python
# ç³»ç»ŸPython
# C:\Python311\
#   â”œâ”€â”€ requests 2.28.0
#   â”œâ”€â”€ flask 2.0.0
#   â””â”€â”€ ...

# è™šæ‹Ÿç¯å¢ƒA
# project-a/venv/
#   â”œâ”€â”€ requests 2.28.0  # é¡¹ç›®Açš„ç‰ˆæœ¬
#   â””â”€â”€ ...

# è™šæ‹Ÿç¯å¢ƒB
# project-b/venv/
#   â”œâ”€â”€ requests 2.31.0  # é¡¹ç›®Bçš„ç‰ˆæœ¬
#   â””â”€â”€ ...
```

**ä»·å€¼**ï¼š
- **éš”ç¦»æ€§**ï¼šæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹ä¾èµ–
- **å¯é‡ç°**ï¼špoetry.lock ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´
- **å¯ç§»æ¤**ï¼šé…ç½®æ–‡ä»¶å³å¯è¿˜åŸç¯å¢ƒ

#### ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç®¡ç†ï¼Ÿ

**å®‰å…¨æ€§**ï¼š
```python
# âŒ é”™è¯¯ï¼šç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
DB_PASSWORD = "admin123"  # ä¼šæäº¤åˆ°Git

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
DB_PASSWORD = os.getenv("DB_PASSWORD")  # ä»æ–‡ä»¶è¯»å–ï¼Œä¸æäº¤
```

**çµæ´»æ€§**ï¼š
```python
# å¼€å‘ç¯å¢ƒ
DEBUG=True
DB_HOST=localhost

# ç”Ÿäº§ç¯å¢ƒ
DEBUG=False
DB_HOST=192.168.1.100
```

#### ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—ç³»ç»Ÿï¼Ÿ

**å¯¹æ¯”**ï¼š
```python
# âŒ ä½¿ç”¨ print
print("ç”¨æˆ·ç™»å½•å¤±è´¥")
# é—®é¢˜ï¼šæ— æ³•æ§åˆ¶çº§åˆ«ï¼Œæ— æ³•æŒä¹…åŒ–ï¼Œæ— ä¸Šä¸‹æ–‡

# âœ… ä½¿ç”¨ logger
logger.error("ç”¨æˆ·ç™»å½•å¤±è´¥", user_id=123, reason="å¯†ç é”™è¯¯")
# ä¼˜åŠ¿ï¼šç»“æ„åŒ–ã€å¯æœç´¢ã€å¯åˆ†æ
```

#### ä¸ºä»€ä¹ˆéœ€è¦ä»£ç è§„èŒƒï¼Ÿ

**åä½œæ•ˆç‡**ï¼š
```python
# ç»Ÿä¸€é£æ ¼å
def get_user(user_id: int) -> User:
    """æ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·"""
    return db.query(User).filter(User.id == user_id).first()

# æ‰€æœ‰äººå†™çš„ä»£ç éƒ½ä¸€æ ·
# å‡å°‘è®¤çŸ¥è´Ÿæ‹…
# æé«˜å®¡æŸ¥æ•ˆç‡
```

## ğŸ”¥ è®°è´¦ç³»ç»Ÿå®æˆ˜

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
poetry new accounting-system
cd accounting-system

# æ·»åŠ ä¾èµ–
poetry add fastapi uvicorn sqlalchemy pydantic-settings pymysql redis
poetry add --group dev black ruff loguru pytest

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p src/accounting_system/{config,models,services,api,utils}
mkdir -p tests logs docs
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®é¡¹ç›®

**åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼š

```python
# src/accounting_system/config/__init__.py
from .settings import settings
from .logger import logger

__all__ = ["settings", "logger"]
```

```python
# src/accounting_system/config/settings.py
from pydantic import Field
from pydantic_settings import BaseSettings, SettingsConfigDict


class Settings(BaseSettings):
    """åº”ç”¨é…ç½®"""

    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        case_sensitive=False,
    )

    APP_NAME: str = "è®°è´¦ç³»ç»Ÿ"
    DEBUG: bool = True

    # æ•°æ®åº“
    DB_HOST: str = "localhost"
    DB_PORT: int = 3306
    DB_USER: str = "root"
    DB_PASSWORD: str = ""
    DB_NAME: str = "accounting"

    @property
    def DATABASE_URL(self) -> str:
        return f"mysql+pymysql://{self.DB_USER}:{self.DB_PASSWORD}@{self.DB_HOST}:{self.DB_PORT}/{self.DB_NAME}"


settings = Settings()
```

```python
# src/accounting_system/config/logger.py
import sys
from pathlib import Path
from loguru import logger


def setup_logger():
    logger.remove()

    # æ§åˆ¶å°
    logger.add(
        sys.stdout,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <level>{message}</level>",
        level="DEBUG" if settings.DEBUG else "INFO",
    )

    # æ–‡ä»¶
    log_path = Path("logs")
    log_path.mkdir(exist_ok=True)

    logger.add(
        log_path / "app_{time:YYYY-MM-DD}.log",
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {message}",
        rotation="00:00",
        retention="30 days",
    )


setup_logger()
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºåº”ç”¨å…¥å£

```python
# src/accounting_system/main.py
from fastapi import FastAPI
from accounting_system.config import settings, logger

app = FastAPI(
    title=settings.APP_NAME,
    debug=settings.DEBUG,
)


@app.get("/")
async def root():
    logger.info("è®¿é—®æ ¹è·¯å¾„")
    return {"message": "è®°è´¦ç³»ç»ŸAPI", "version": "0.1.0"}


@app.get("/health")
async def health():
    return {"status": "ok"}


if __name__ == "__main__":
    import uvicorn

    uvicorn.run(
        "main:app",
        host="127.0.0.1",
        port=9099,
        reload=settings.DEBUG,
    )
```

### ç¬¬å››æ­¥ï¼šç¯å¢ƒé…ç½®

**åˆ›å»º .env.example**ï¼š
```env
APP_NAME=è®°è´¦ç³»ç»Ÿ
DEBUG=True

DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=accounting
```

**åˆ›å»º .env**ï¼š
```env
APP_NAME=è®°è´¦ç³»ç»Ÿ
DEBUG=True

DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=admin123
DB_NAME=accounting
```

### ç¬¬äº”æ­¥ï¼šè¿è¡Œæµ‹è¯•

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
poetry shell

# è¿è¡Œåº”ç”¨
python src/accounting_system/main.py

# è®¿é—®æµ‹è¯•
# http://127.0.0.1:9099
# http://127.0.0.1:9099/docs
```

**è¿è¡Œæ•ˆæœ**ï¼š
```bash
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:9099
```

**æ—¥å¿—è¾“å‡º**ï¼š
```bash
2024-01-15 10:30:45 | INFO     | è®¿é—®æ ¹è·¯å¾„
2024-01-15 10:30:46 | INFO     | è®¿é—®æ ¹è·¯å¾„
```

### ç¬¬å…­æ­¥ï¼šä»£ç è§„èŒƒæ£€æŸ¥

```bash
# æ ¼å¼åŒ–ä»£ç 
black src/

# æ£€æŸ¥ä»£ç 
ruff check src/

# è‡ªåŠ¨ä¿®å¤
ruff check --fix src/
```

## ğŸ§  æ€ç»´å»¶ä¼¸

### è®¾è®¡åŸåˆ™

**1. çº¦å®šä¼˜äºé…ç½®**
```
ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå‡å°‘å†³ç­–æˆæœ¬
- æ ‡å‡†ç›®å½•ç»“æ„
- ç»Ÿä¸€å‘½åè§„èŒƒ
- é»˜è®¤é…ç½®æ–‡ä»¶
```

**2. é…ç½®åˆ†ç¦»**
```
ä»£ç  vs é…ç½®
- ä»£ç ï¼šä¸šåŠ¡é€»è¾‘
- é…ç½®ï¼šç¯å¢ƒç›¸å…³
- åˆ†ç¦»åŸåˆ™ï¼šå¯å˜çš„ä¸œè¥¿éƒ½åº”è¯¥å¯é…ç½®
```

**3. æ—©æœŸæ—¥å¿—**
```
æ—¥å¿—è¦æ—©äºåŠŸèƒ½å¼€å‘
- å…ˆæ­å»ºæ—¥å¿—ç³»ç»Ÿ
- æ‰€æœ‰å…³é”®æ“ä½œéƒ½è®°å½•
- å‡ºé—®é¢˜æ—¶æ‰æœ‰æ®å¯æŸ¥
```

### æƒè¡¡è€ƒè™‘

**Poetry vs pip + venv**ï¼š

| ç‰¹æ€§ | Poetry | pip + venv |
|-----|--------|------------|
| ä¾èµ–è§£æ | è‡ªåŠ¨å¤„ç†å†²çª | æ‰‹åŠ¨è§£å†³ |
| é”å®šç‰ˆæœ¬ | poetry.lock | requirements.txt |
| è™šæ‹Ÿç¯å¢ƒ | è‡ªåŠ¨ç®¡ç† | æ‰‹åŠ¨åˆ›å»º |
| å­¦ä¹ æ›²çº¿ | è¾ƒé™¡ | å¹³ç¼“ |
| æ¨èåœºæ™¯ | æ–°é¡¹ç›® | ç®€å•è„šæœ¬ |

**é…ç½®ç®¡ç†æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|------|---------|
| pydantic-settings | ç±»å‹å®‰å…¨ã€è‡ªåŠ¨éªŒè¯ | éœ€è¦å®šä¹‰ç±» | å¤§å‹é¡¹ç›® |
| python-dotenv | ç®€å•ç›´æ¥ | æ— ç±»å‹æ£€æŸ¥ | å°å‹é¡¹ç›® |
| YAMLé…ç½® | å¯è¯»æ€§å¥½ | éœ€è¦é¢å¤–è§£æ | å¤æ‚é…ç½® |

### æœ€ä½³å®è·µ

**ä¾èµ–ç®¡ç†**ï¼š
```bash
# 1. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
poetry install

# 2. åŒºåˆ†ä¾èµ–ç±»å‹
poetry add fastapi  # ç”Ÿäº§ä¾èµ–
poetry add --group dev pytest  # å¼€å‘ä¾èµ–

# 3. é”å®šç‰ˆæœ¬
# æäº¤ poetry.lock

# 4. å®šæœŸæ›´æ–°
poetry update
```

**é…ç½®ç®¡ç†**ï¼š
```python
# 1. æ•æ„Ÿä¿¡æ¯å¿…é¡»ç”¨ç¯å¢ƒå˜é‡
SECRET_KEY = os.getenv("SECRET_KEY")

# 2. æä¾›é»˜è®¤å€¼
PORT: int = Field(default=9099)

# 3. ç±»å‹éªŒè¯
DB_PORT: int  # ä¼šè‡ªåŠ¨éªŒè¯ç±»å‹

# 4. é…ç½®æ¨¡æ¿
# æä¾› .env.example
```

**æ—¥å¿—è®°å½•**ï¼š
```python
# 1. ç»“æ„åŒ–æ—¥å¿—
logger.info("ç”¨æˆ·ç™»å½•", user_id=123, ip="192.168.1.1")

# 2. æ—¥å¿—çº§åˆ«
logger.debug()  # è°ƒè¯•ä¿¡æ¯
logger.info()   # ä¸€èˆ¬ä¿¡æ¯
logger.warning()  # è­¦å‘Š
logger.error()    # é”™è¯¯
logger.critical() # ä¸¥é‡é”™è¯¯

# 3. å¼‚å¸¸è®°å½•
try:
    ...
except Exception as e:
    logger.exception("å‘ç”Ÿå¼‚å¸¸")  # è‡ªåŠ¨è®°å½•å †æ ˆ
```

## âœ… æ£€æŸ¥ç‚¹

- [ ] èƒ½å¦åˆ›å»ºç‹¬ç«‹çš„Pythonè™šæ‹Ÿç¯å¢ƒï¼Ÿ
- [ ] æ˜¯å¦ç†è§£ç¯å¢ƒå˜é‡çš„ä½œç”¨ï¼Ÿ
- [ ] èƒ½å¦é…ç½®ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿï¼Ÿ
- [ ] æ˜¯å¦ä¼šä½¿ç”¨ black å’Œ ruffï¼Ÿ
- [ ] é¡¹ç›®ç›®å½•ç»“æ„æ˜¯å¦åˆç†ï¼Ÿ
- [ ] æ•æ„Ÿä¿¡æ¯æ˜¯å¦éƒ½æ”¾åœ¨ .env ä¸­ï¼Ÿ

## ğŸš€ è¿ç§»æŒ‘æˆ˜

### æŒ‘æˆ˜1ï¼šå¤šäººåä½œ

**åœºæ™¯**ï¼šå›¢é˜Ÿæœ‰3ä¸ªäººï¼Œå¦‚ä½•ç»Ÿä¸€å¼€å‘ç¯å¢ƒï¼Ÿ

**è¦æ±‚**ï¼š
1. åˆ›å»º .env.example æ–‡ä»¶
2. åœ¨ README.md ä¸­å†™æ˜ç¯å¢ƒæ­å»ºæ­¥éª¤
3. æäº¤ poetry.lockï¼ˆæˆ– requirements.txtï¼‰
4. ç¼–å†™å¼€å‘ç¯å¢ƒé…ç½®æ–‡æ¡£

### æŒ‘æˆ˜2ï¼šç¯å¢ƒåˆ‡æ¢

**åœºæ™¯**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ä¸‰ä¸ªç¯å¢ƒ

**è¦æ±‚**ï¼š
1. åˆ›å»º .env.devã€.env.testã€.env.prod
2. ä¿®æ”¹é…ç½®ç±»æ”¯æŒç¯å¢ƒåˆ‡æ¢
3. å¯åŠ¨æ—¶æŒ‡å®šç¯å¢ƒï¼ˆå¦‚ `python app.py --env=prod`ï¼‰
4. ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒæ•°æ®åº“

### æŒ‘æˆ˜3ï¼šæ—¥å¿—åˆ†æ

**åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒå‡ºç°é”™è¯¯ï¼Œéœ€è¦å¿«é€Ÿå®šä½

**è¦æ±‚**ï¼š
1. æ·»åŠ è¯·æ±‚IDåˆ°æ—¥å¿—ï¼ˆè¿½è¸ªå®Œæ•´è°ƒç”¨é“¾ï¼‰
2. é”™è¯¯æ—¥å¿—å‘é€åˆ°é‚®ç®±/é’‰é’‰
3. ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·ï¼ˆå¦‚ELKï¼‰
4. è®¾ç½®æ—¥å¿—å‘Šè­¦è§„åˆ™

---

## ğŸ“š æ€»ç»“

å·¥ç¨‹åŒ–é¡¹ç›®æ­å»ºæ˜¯ä¸“ä¸šå¼€å‘çš„åŸºç¡€ï¼Œå®ƒè§£å†³äº†ï¼š

1. **ä¾èµ–éš”ç¦»**ï¼šè™šæ‹Ÿç¯å¢ƒé¿å…å†²çª
2. **é…ç½®ç®¡ç†**ï¼šç¯å¢ƒå˜é‡ä¿è¯å®‰å…¨
3. **æ—¥å¿—ç³»ç»Ÿ**ï¼šé—®é¢˜è¿½è¸ªæœ‰æ®å¯æŸ¥
4. **ä»£ç è§„èŒƒ**ï¼šå›¢é˜Ÿåä½œé«˜æ•ˆç»Ÿä¸€

**å…³é”®è¦ç‚¹**ï¼š
- ä½¿ç”¨ Poetry ç®¡ç†ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒ
- ç”¨ pydantic-settings ç®¡ç†é…ç½®
- ç”¨ loguru è®°å½•ç»“æ„åŒ–æ—¥å¿—
- ç”¨ black å’Œ ruff ç»Ÿä¸€ä»£ç é£æ ¼

**ä¸‹ä¸€æ­¥**ï¼šåœ¨å·¥ç¨‹åŒ–åŸºç¡€ä¸Šï¼Œå¼€å§‹å­¦ä¹  Python è¯­æ³•åŸºç¡€ã€‚
